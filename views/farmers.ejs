<%- include("partials/header.ejs") %>  <!-- Include header from partials -->

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="page-title"><i class="fas fa-users"></i> All Farmer Stores</h1>
            <p class="page-subtitle">Multi-vendor storefronts where farmers build their brand</p>
            <nav class="breadcrumb">
                <a href="/" class="breadcrumb-link">Home</a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Farmers</span>
            </nav>
        </div>
    </section>

    <!-- All Farmers Section -->
    <section id="all-farmers" class="farmer-store">
        <div class="container">
            <div class="section-header">
                <div>
                    <h2 class="section-title">All Registered Farmers</h2>
                    <p class="section-subtitle">Browse through our network of trusted farmers</p>
                </div>
            </div>

            <% if (!farmers || farmers.length === 0) { %>
                <div style="text-align:center; padding:60px 20px;">
                    <p style="font-size:1.2rem; color:#666;">No farmers registered yet.</p>
                    <p>Check back soon to see our farmer network grow!</p>
                </div>
            <% } else { %>
                <% farmers.forEach((farmer, index) => { %>
                    <div class="store-profile" style="margin-top: <%= index > 0 ? '40px' : '0' %>;">
                        <div class="store-header">
                            <div class="store-avatar">
                                <img src="https://ui-avatars.com/api/?name=<%= farmer.farm_name %>&background=2ecc71&color=fff&size=150" alt="<%= farmer.farm_name %>" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27150%27 height=%27150%27%3E%3Crect fill=%27%232ecc71%27 width=%27150%27 height=%27150%27/%3E%3Ctext fill=%27white%27 font-family=%27Arial%27 font-size=%2760%27 x=%2750%25%27 y=%2750%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27%3EðŸ‘¨â€ðŸŒ¾%3C/text%3E%3C/svg%3E'">
                                <% if (farmer.is_verified) { %>
                                    <span class="verified-seller"><i class="fas fa-check-circle"></i></span>
                                <% } %>
                            </div>
                            <div class="store-info">
                                <a href="/farmer/<%= farmer.id %>" style="text-decoration: none; color: inherit;">
                                    <h3 class="store-name"><%= farmer.farm_name %></h3>
                                </a>
                                <p class="store-location"><i class="fas fa-map-marker-alt"></i> <%= farmer.district || farmer.location || 'Bangladesh' %></p>
                                <p class="store-member"><i class="fas fa-calendar-alt"></i> Member since <%= new Date(farmer.created_at).getFullYear() %></p>
                                <div class="store-rating">
                                    <div class="stars">
                                        <% for (let i = 0; i < Math.floor(parseFloat(farmer.rating) || 4); i++) { %>
                                            <i class="fas fa-star"></i>
                                        <% } %>
                                        <% if ((parseFloat(farmer.rating) || 4) % 1 >= 0.5) { %>
                                            <i class="fas fa-star-half-alt"></i>
                                        <% } %>
                                    </div>
                                    <span class="rating-text"><%= (parseFloat(farmer.rating) || 4).toFixed(1) %> (<%= farmer.total_reviews || 0 %> reviews)</span>
                                </div>
                            </div>
                            <div class="store-actions">
                                <button class="btn btn-outline"><i class="fas fa-heart"></i> Follow</button>
                                <a href="/farmer/<%= farmer.id %>/contact" class="btn btn-primary" style="text-decoration: none;"><i class="fas fa-comment"></i> Contact</a>
                            </div>
                        </div>

                        <div class="store-metrics">
                            <div class="metric">
                                <i class="fas fa-box"></i>
                                <div class="metric-info">
                                    <span class="metric-value"><%= farmer.product_count || 0 %></span>
                                    <span class="metric-label">Products</span>
                                </div>
                            </div>
                            <div class="metric">
                                <i class="fas fa-star"></i>
                                <div class="metric-info">
                                    <span class="metric-value"><%= (parseFloat(farmer.rating) || 4).toFixed(1) %>/5</span>
                                    <span class="metric-label">Rating</span>
                                </div>
                            </div>
                            <div class="metric">
                                <i class="fas fa-check-circle"></i>
                                <div class="metric-info">
                                    <span class="metric-value"><%= farmer.is_verified ? 'Verified' : 'Active' %></span>
                                    <span class="metric-label">Status</span>
                                </div>
                            </div>
                            <div class="metric">
                                <i class="fas fa-map-marker-alt"></i>
                                <div class="metric-info">
                                    <span class="metric-value"><%= farmer.district || 'Bangladesh' %></span>
                                    <span class="metric-label">Location</span>
                                </div>
                            </div>
                        </div>

                        <div class="store-inventory">
                            <h4>Products from <%= farmer.farm_name %></h4>
                            <% if (!farmer.products || farmer.products.length === 0) { %>
                                <div style="text-align:center; padding:40px; color:#999;">
                                    <p>No products yet from this farmer</p>
                                </div>
                            <% } else { %>
                                <div class="inventory-grid">
                                    <% farmer.products.forEach(product => { %>
                                        <a href="/product/<%= product.id %>" class="inventory-item" style="text-decoration:none; color:inherit;">
                                            <div style="height:120px; background:#f8fafc; border-radius:6px; display:flex; align-items:center; justify-content:center; overflow:hidden; margin-bottom:8px;">
                                                <% if (product.image_url) { %>
                                                    <img src="<%= product.image_url %>" alt="<%= product.name %>" style="max-height:120px; max-width:100%; object-fit:cover;">
                                                <% } else { %>
                                                    <i class="fas fa-image" style="color:#cbd5e0; font-size:32px;"></i>
                                                <% } %>
                                            </div>
                                            <span class="item-name"><%= product.name %></span>
                                            <span class="item-price">à§³<%= product.price %>/<%= product.unit || 'kg' %></span>
                                        </a>
                                    <% }) %>
                                    <a href="/farmer/<%= farmer.id %>" class="inventory-item" style="text-decoration:none; color:inherit; display:flex; align-items:center; justify-content:center; flex-direction:column;">
                                        <span class="view-all-text">View All<br>Products</span>
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </section>

<script>
    // Mobile navigation toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');
    const navActions = document.querySelector('.nav-actions');
    
    if (navToggle && navMenu && navActions) {
        navToggle.addEventListener('click', function() {
            navMenu.classList.toggle('active');
            navActions.classList.toggle('active');
        });
    }

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });
</script>

<%- include("partials/footer.ejs") %>  <!-- Include footer from partials -->