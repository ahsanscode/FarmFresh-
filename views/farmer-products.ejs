<%- include("partials/header.ejs") %>

<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <h1 class="page-title"><i class="fas fa-store"></i> <%= farmer.farm_name %></h1>
        <p class="page-subtitle">All products from this farm</p>
        <nav class="breadcrumb">
            <a href="/" class="breadcrumb-link">Home</a>
            <span class="breadcrumb-separator">/</span>
            <a href="/farmers" class="breadcrumb-link">Farmers</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current"><%= farmer.farm_name %></span>
        </nav>
    </div>
</section>

<!-- Farmer Info Section -->
<section style="padding: 30px 0; border-bottom: 1px solid #e5e7eb;">
    <div class="container">
        <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 30px; align-items: center;">
            <!-- Farmer Avatar -->
            <div style="text-align: center;">
                <img src="https://ui-avatars.com/api/?name=<%= farmer.farm_name %>&background=2ecc71&color=fff&size=120" 
                     alt="<%= farmer.farm_name %>"
                     style="width: 120px; height: 120px; border-radius: 50%; border: 3px solid #2ecc71;">
                <% if (farmer.is_verified) { %>
                    <div style="margin-top: 10px;">
                        <span style="background: #10b981; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px;">
                            <i class="fas fa-check-circle"></i> Verified
                        </span>
                    </div>
                <% } %>
            </div>

            <!-- Farmer Info -->
            <div>
                <h2 style="margin: 0 0 8px; font-size: 28px;"><%= farmer.farm_name %></h2>
                <p style="margin: 0 0 12px; color: #6b7280;">
                    <i class="fas fa-map-marker-alt"></i> <%= farmer.district || farmer.location || 'Bangladesh' %>
                </p>
                <p style="margin: 0 0 12px; color: #6b7280;">
                    <i class="fas fa-calendar-alt"></i> Member since <%= new Date(farmer.created_at).getFullYear() %>
                </p>
                <div style="display: flex; gap: 20px;">
                    <div>
                        <div style="font-size: 18px; font-weight: 600; color: #111;">
                            <%= (parseFloat(farmer.rating) || 4).toFixed(1) %>/5
                        </div>
                        <div style="color: #6b7280; font-size: 14px;">
                            <% for (let i = 0; i < Math.floor(parseFloat(farmer.rating) || 4); i++) { %>
                                <i class="fas fa-star"></i>
                            <% } %>
                            <% if ((parseFloat(farmer.rating) || 4) % 1 >= 0.5) { %>
                                <i class="fas fa-star-half-alt"></i>
                            <% } %>
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 18px; font-weight: 600; color: #111;">
                            <%= farmer.total_reviews || 0 %>
                        </div>
                        <div style="color: #6b7280; font-size: 14px;">Reviews</div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button class="btn btn-outline" style="padding: 10px 20px;">
                    <i class="fas fa-heart"></i> Follow
                </button>
                <a href="/farmer/<%= farmer.id %>/contact" class="btn btn-primary" style="padding: 10px 20px; text-decoration: none;">
                    <i class="fas fa-comment"></i> Contact
                </a>
            </div>
        </div>
    </div>
</section>

<!-- All Products Section -->
<section style="padding: 40px 0;">
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div>
                <h2 style="margin: 0 0 8px; font-size: 24px;">All Products</h2>
                <p style="margin: 0; color: #6b7280;"><%= products.length %> products available</p>
            </div>
        </div>

        <% if (!products || products.length === 0) { %>
            <div style="text-align: center; padding: 60px 20px; background: #f8fafc; border-radius: 10px;">
                <i class="fas fa-box" style="font-size: 48px; color: #cbd5e0; margin-bottom: 16px; display: block;"></i>
                <p style="font-size: 1.2rem; color: #6b7280;">No products yet from this farmer</p>
                <p style="color: #9ca3af;">Check back soon for new products!</p>
            </div>
        <% } else { %>
            <div class="product-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                <% products.forEach(product => { %>
                    <% const savings = product.market_price && product.price 
                        ? Math.round((1 - product.price / product.market_price) * 100) 
                        : 0; %>
                    <div class="product-card" style="border: 1px solid #e5e7eb; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.04); transition: all 0.3s ease; cursor: pointer;" 
                         onclick="window.location.href='/product/<%= product.id %>'">
                        <a href="/product/<%= product.id %>" style="text-decoration: none; color: inherit;">
                            <div class="product-image" style="position: relative; height: 200px; background: #f8fafc; overflow: hidden;">
                                <img src="<%= product.image_url || '/uploads/default-product.png' %>" 
                                     alt="<%= product.name %>"
                                     style="width: 100%; height: 100%; object-fit: cover;"
                                     onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27250%27 height=%27200%27%3E%3Crect fill=%27%23e8f5e9%27 width=%27250%27 height=%27200%27/%3E%3Ctext fill=%27%232ecc71%27 font-family=%27Arial%27 font-size=%2716%27 x=%2750%25%27 y=%2750%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27%3E<%= product.name.charAt(0).toUpperCase() %>%3C/text%3E%3C/svg%3E'">
                                <div style="position: absolute; top: 10px; left: 10px; display: flex; gap: 8px;">
                                    <% if (product.is_verified) { %>
                                        <span class="badge" style="background: #10b981; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px;">
                                            <i class="fas fa-check-circle"></i> Verified
                                        </span>
                                    <% } %>
                                </div>
                                <button class="wishlist-btn" style="position: absolute; top: 10px; right: 10px; background: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>
                        </a>
                        <div class="product-info" style="padding: 16px;">
                            <h3 class="product-name" style="margin: 0 0 8px; font-size: 16px; font-weight: 600;">
                                <a href="/product/<%= product.id %>" style="text-decoration: none; color: inherit;"><%= product.name %></a>
                            </h3>
                            <p style="margin: 0 0 8px; color: #6b7280; font-size: 14px;">Category: <%= product.category || 'General' %></p>
                            <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px;">
                                <span style="color: #111; font-weight: 600; font-size: 16px;">৳<%= product.price %></span>
                                <% if (product.market_price) { %>
                                    <span style="color: #9ca3af; text-decoration: line-through; font-size: 14px;">৳<%= product.market_price %></span>
                                    <span style="background: #fef3c7; color: #b45309; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                        Save <%= savings %>%
                                    </span>
                                <% } %>
                            </div>
                            <p style="margin: 0 0 12px; color: #6b7280; font-size: 14px;">
                                Stock: <strong><%= product.stock_quantity %></strong>
                            </p>
                            <button class="btn btn-primary" style="width: 100%; padding: 10px; border: none; background: #2ecc71; color: white; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                <i class="fas fa-shopping-cart"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } %>
    </div>
</section>

<script>
    // Add hover effect
    document.querySelectorAll('.product-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.boxShadow = '0 8px 16px rgba(0,0,0,0.1)';
            this.style.transform = 'translateY(-4px)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.04)';
            this.style.transform = 'translateY(0)';
        });
    });
</script>

<%- include("partials/footer.ejs") %>
